<?phpnamespace soft\grid;use kartik\grid\GridView as KartikGridView;use soft\extra\TemplateRender;use soft\helpers\ArrayHelper;use soft\helpers\Url;use soft\web\View;use soft\widget\button\BulkButtons;use soft\widget\button\Button;use soft\widget\MultiLinkPager;use Yii;/** * @author Shukurullo Odilov * @property View $view */class GridView extends KartikGridView{    use SoftGridViewTrait;    public $dataColumnClass = 'soft\grid\DataColumn';    public $pjax = true;    public $striped = true;    public $condensed = true;    public $responsive = true;    public $bordered = true;    public $autoGenerateId = false;    public $serialColumn = true;    public $toolbarTemplate = -1;    public $toolbarButtons = [];    public $bulkButtons = [];    public $bulkButtonsTemplate = false;    public $pagerDropDown = false;    public $responsiveWrap = false;    public $filterPosition = self::FILTER_POS_HEADER;    public $export = [        'options' => [            'class' => 'btn btn-default'        ]    ];    public $summary = <<<HTML        Намойиш этиляпти: <b>{begin}</b>-<b>{end}</b>. Жами: <b>{totalCount}</b> та ёзувHTML;    public $panelFooterTemplate = <<< HTML        <div class="pull-left">    {summary}         </div>    <div class="pull-right">             <div class="kv-panel-pager">            {pager}        </div>    </div>    {footer}    <div class="clearfix"></div>HTML;    public $panelBeforeTemplate = <<< HTML    <div class="row">        <div class="col-md-6">            {before}        </div>        <div class="col-md-6">        {toolbarContainer}        </div>    </div>HTML;    /**     * @var bool     */    public $exportButton = false;    /**     * @var bool Whether register break-words css styles     * @see registerBreakWordsStyles()     */    public $breakWords = false;    /**     * @throws \yii\base\InvalidConfigException     * @throws \Exception     */    public function init()    {        $this->panel = ArrayHelper::merge([            'heading' => false,            'before' => '&nbsp;',            'after' => '{bulk-buttons}',            'options' => ['style' => ['border-top' => '3px solid #3c8dbc;']],        ], $this->panel);        $this->initDefaultColumns();        parent::init();        $this->renderToolbarContent();        $this->renderBulkButtons();        $this->registerBreakWordsStyles();        $this->pager = array_merge([            'class' => MultiLinkPager::class,            'maxButtonCount' => 10,            'prevPageCssClass' => 'prev hidden-xs',            'nextPageCssClass' => 'next hidden-xs',            'activePageAsLink' => false        ], $this->pager);    }    /**     * @param $autoGenerate bool     * @return string|null     */    public function getId($autoGenerate = true)    {        $id = parent::getId(false);        if (empty($id) && !$this->autoGenerateId) {            return 'crud-datatable';        }        return parent::getId($autoGenerate);    }    //<editor-fold desc="Columns">    /**     * @return array     */    public function defaultColumns()    {        return [            'image' => [                'filter' => false,                'attribute' => 'image',                'format' => ['image', ['height' => '100px']],            ],            'updated_at' => [                'attribute' => 'updated_at',                'format' => 'dateTimeUz',                'filter' => false,            ],            'created_at' => [                'attribute' => 'created_at',                'format' => 'dateTimeUz',                'filter' => false,            ],            'serialColumn' => [                'class' => SerialColumn::class,                'width' => '50px',            ],            'checkboxColumn' => [                'class' => 'kartik\grid\CheckboxColumn',                'width' => '20px',            ],            'radioColumn' => [                'class' => 'kartik\grid\RadioColumn',                'width' => '20px',            ],            'actionColumn' => [                'class' => 'soft\grid\ActionColumn',                'width' => '100px',            ],        ];    }    /**     * @throws \Exception     */    public function initDefaultColumns()    {        $result = [];        $defaultColumns = $this->defaultColumns();        if ($this->serialColumn && !in_array("serialColumn", $this->columns) && !array_key_exists('serialColumn', $this->columns)) {            array_unshift($result, $defaultColumns['serialColumn']);        }        if ($this->hasBulkButtons() && !in_array("checkboxColumn", $this->columns)) {            array_unshift($result, $defaultColumns['checkboxColumn']);        }        foreach ($this->columns as $key => $value) {            if (is_string($value)) {                if (ArrayHelper::keyExists($value, $defaultColumns)) {                    $result[] = ArrayHelper::getValue($defaultColumns, $value);                } else {                    $result[] = $value;                }            } else {                if (ArrayHelper::keyExists($key, $defaultColumns)) {                    $column = ArrayHelper::merge(ArrayHelper::getValue($defaultColumns, $key), $value);                } else {                    $column = $value;                }                $result[] = $column;            }        }        $this->columns = $result;    }    //</editor-fold>    //<editor-fold desc="Toolbar">    /**     * Default button configuration for toolbar.     * Every button is instance of [[soft\widget\button\Button]] widget.     * @return array[]     * @see Button     */    public function defaultToolbarButtons()    {        return [            'create' => [                'pjax' => false,                'modal' => false,                'url' => Url::to(['create']),                'cssClass' => 'btn btn-default',                'icon' => 'plus',                'title' => Yii::t('site', 'Create a new'),            ],            'refresh' => [                'url' => Url::current(),                'icon' => 'sync-alt',                'cssClass' => 'btn btn-default',                'title' => Yii::t('site', 'Refresh'),            ],        ];    }    /**     * @return string     * @throws \Exception     */    public function renderToolbarContent()    {        if ($this->toolbar == false) {            return '';        }        $content = $this->renderToolbarButtons();        if ($this->exportButton) {            $content .= "{export}";        }        if ($this->pagerDropDown) {            $content .= $this->renderPagerDropdown();        }        $this->toolbar = [            [                'content' => $content,            ]        ];    }    /**     * Renders bulk buttons     * @return array|string     * @throws \Exception     * @see defaultToolbarButtons     * @see \soft\widget\button\Buttons     */    public function renderToolbarButtons()    {        if (!is_array($this->toolbarButtons)) {            return $this->toolbarButtons;        }        $buttons = [];        $this->toolbarButtons = ArrayHelper::merge($this->defaultToolbarButtons(), $this->toolbarButtons);        foreach ($this->toolbarButtons as $buttonName => $value) {            if (is_string($value)) {                $buttons[$buttonName] = $value;                continue;            }            $buttons[$buttonName] = Button::widget($value);        }        return TemplateRender::widget([            'template' => $this->toolbarTemplate,            'items' => $buttons,        ]);    }    //</editor-fold>    //<editor-fold desc="Bulk buttons">    /**     * Renders bulk buttons     * @return false if widget has no any bulk button     * @throws \Exception     * @see defaultBulkButtons     * @see BulkButtons     */    public function renderBulkButtons()    {        if (!$this->hasBulkButtons()) {            return false;        }        if (!is_array($this->bulkButtons)) {            $content = $this->bulkButtons;        } else {            $this->bulkButtons = ArrayHelper::merge($this->defaultBulkButtons(), $this->bulkButtons);            $content = BulkButtons::widget([                'template' => $this->bulkButtonsTemplate,                'buttons' => $this->bulkButtons,            ]);        }        $this->panel['after'] = $content;        $this->view->registerAjaxCrudAssets();    }    /**     * Default button configuration for bulk buttons.     * Every button is instance of [[soft\widget\button\BulkButton]] widget.     * @return array[]     * @see renderBulkButtons     * @see \soft\widget\button\BulkButton     */    public function defaultBulkButtons()    {        return [            'delete' => [                "confirmMessage" => Yii::t('site', 'Are you sure to delete all selected items?'),                'content' => Yii::t('site', "Delete"),                'url' => Url::to(['bulkdelete']),                'icon' => 'trash',                'cssClass' => 'btn btn-danger',                'title' => Yii::t('site', 'Delete selected items'),            ],        ];    }    /**     * @return bool     */    public function hasBulkButtons()    {        if (!isset($this->panel['after'])) {            return false;        }        if ($this->bulkButtons === false || $this->bulkButtonsTemplate === false) {            if ($this->panel['after'] == "{bulk-buttons}") {                $this->panel['after'] = false;            }            return false;        }        if ($this->panel['after'] != "{bulk-buttons}") {            return false;        }        return true;    }    //</editor-fold>    /**     * Registers style to break words in a cell     * @see breakWords     */    public function registerBreakWordsStyles()    {        if ($this->breakWords) {            $css = "            #{$this->getId()} table td {                word-break: break-word;                white-space: normal;                }            ";            $this->view->registerCss($css);        }    }}?>